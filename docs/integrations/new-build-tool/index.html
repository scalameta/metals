<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-integrations/new-build-tool" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Integrating a new build tool | Metals</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=http://scalameta.org/metals/img/scalameta-logo.png /><meta data-rh=true name=twitter:image content=http://scalameta.org/metals/img/scalameta-logo.png /><meta data-rh=true property=og:url content=http://scalameta.org/metals/docs/integrations/new-build-tool /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Integrating a new build tool | Metals"/><meta data-rh=true name=description content="Metals uses the"/><meta data-rh=true property=og:description content="Metals uses the"/><link data-rh=true rel=icon href=/metals/img/favicon.ico /><link data-rh=true rel=canonical href=http://scalameta.org/metals/docs/integrations/new-build-tool /><link data-rh=true rel=alternate href=http://scalameta.org/metals/docs/integrations/new-build-tool hreflang=en /><link data-rh=true rel=alternate href=http://scalameta.org/metals/docs/integrations/new-build-tool hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"http://scalameta.org/metals/docs/integrations/new-build-tool","name":"Integrating a new build tool","position":1}]}</script><link rel=alternate type=application/rss+xml href=/metals/blog/rss.xml title="Metals RSS Feed"><link rel=alternate type=application/atom+xml href=/metals/blog/atom.xml title="Metals Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=UA-140140828-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-140140828-1",{})</script><link rel=stylesheet href=/metals/assets/css/styles.0a68ebe2.css /><script src=/metals/assets/js/runtime~main.5e553306.js defer></script><script src=/metals/assets/js/main.b048d074.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/metals/img/scalameta-logo.png /><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/metals/><div class=navbar__logo><img src=/metals/img/scalameta-logo.png alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/metals/img/scalameta-logo.png alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div><b class="navbar__title text--truncate">Metals</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/metals/docs/>Docs</a><a class="navbar__item navbar__link" href=/metals/blog/>Blog</a><a href=https://github.com/scalameta/metals target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=Search aria-label=Search class="navbar__search-input searchInput_YFbd" value="" /><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/metals/docs/><span title="Text Editors" class=categoryLinkLabel_W154>Text Editors</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/metals/docs/features/codeactions><span title=Features class=categoryLinkLabel_W154>Features</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/metals/docs/build-tools/overview><span title="Build Tools" class=categoryLinkLabel_W154>Build Tools</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/metals/docs/contributors/project-goals><span title=Contributing class=categoryLinkLabel_W154>Contributing</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/metals/docs/integrations/new-build-tool><span title="Integrating with Metals" class=categoryLinkLabel_W154>Integrating with Metals</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/metals/docs/integrations/new-build-tool><span title="Integrating a new build tool" class=linkLabel_WmDU>Integrating a new build tool</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/metals/docs/integrations/new-editor><span title="Integrating a new editor" class=linkLabel_WmDU>Integrating a new editor</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/metals/docs/integrations/test-explorer><span title="Test Explorer" class=linkLabel_WmDU>Test Explorer</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/metals/docs/integrations/tree-view-protocol><span title="Tree View Protocol" class=linkLabel_WmDU>Tree View Protocol</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/metals/docs/integrations/debug-adapter-protocol><span title="Running and debugging" class=linkLabel_WmDU>Running and debugging</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/metals/docs/troubleshooting/proxy><span title=Troubleshooting class=categoryLinkLabel_W154>Troubleshooting</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/metals/docs/acknowledgements/development><span title=Acknowledgements class=categoryLinkLabel_W154>Acknowledgements</span></a></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/metals/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>Integrating with Metals</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Integrating a new build tool</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Integrating a new build tool</h1></header><p>Metals uses the
<a href=https://github.com/scalacenter/bsp/blob/master/docs/bsp.md target=_blank rel="noopener noreferrer" class="">Build Server Protocol</a>
(BSP) to communicate with build tools. Any build tool that implements the
protocol should work with Metals.</p>
<p>There are two options for integrating Metals with a new build tool:</p>
<ul>
<li class=""><a href=#bloop-build-server class="">via Bloop</a>: emit Bloop JSON configuration files and use
the Bloop build server. The benefit of this approach is that it's simple to
implement but has the downside that compilation happens outside of your build
tool.</li>
<li class=""><a href=#custom-build-server class="">via custom build server</a>: add Build Server Protocol
support to your build tool. The benefit of this approach is that Metals
integrates directly with your build tool, reproducing the same build
environment as your current workflow. The downside of this approach is that it
most likely requires more effort compared to emitting Bloop JSON files.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=enable-semanticdb>Enable SemanticDB<a href=#enable-semanticdb class=hash-link aria-label="Direct link to Enable SemanticDB" title="Direct link to Enable SemanticDB" translate=no>​</a></h2>
<p>If you use the Bloop build server there is nothing that needs to be added in
order to enable SemanticDB. Metals itself will communicate with Bloop to make
sure proper options are enabled.</p>
<p>Otherwise, if you implement a custom build server, the
<a href=https://scalameta.org/docs/semanticdb/guide.html target=_blank rel="noopener noreferrer" class="">SemanticDB</a> compiler plugin
is required for Metals code navigation to work. Only limited Metals features
like diagnostics and code formatting will work without the SemanticDB compiler
plugin enabled.</p>
<p>Users get a warning from Metals when the build server does not enable the
SemanticDB compiler plugin. Users have an option to suppress this warning by
selecting a "Don't show again" option.</p>
<p>Make sure to declare the compiler option <code>"-P:semanticdb:sourceroot:$WORKSPACE"</code>
where <code>$WORKSPACE</code> is the absolute path to the workspace root directory. By
default, the sourceroot is inferred from the working directory of the compiler
process, but it's better to explicitly declare it. If the sourceroot is
misconfigured, then Metals is unable to find the SemanticDB files created by the
compiler plugin.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=recommended-compiler-options>Recommended compiler options<a href=#recommended-compiler-options class=hash-link aria-label="Direct link to Recommended compiler options" title="Direct link to Recommended compiler options" translate=no>​</a></h2>
<p>We recommend you update the following compiler options when using Metals:</p>
<ul>
<li class=""><code>-Xlint</code>: these warnings are helpful in the editor even if you don't have them
enabled in your main build. Consult <code>scalac -Xlint:help</code> for a full list of
available warnings.</li>
<li class=""><code>-Xfatal-warnings</code>: disable this setting even if you have it enabled in your
main build. Fatal warnings prevent code navigation from working when there are
warnings like 'unused import'.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=bloop-build-server>Bloop build server<a href=#bloop-build-server class=hash-link aria-label="Direct link to Bloop build server" title="Direct link to Bloop build server" translate=no>​</a></h2>
<p>Consult the
<a href=https://scalacenter.github.io/bloop/docs/configuration-format/ target=_blank rel="noopener noreferrer" class="">Bloop configuration format</a>
to learn how to emit Bloop JSON files. Once the JSON files have been generated,
use "<a class="" href=/metals/docs/integrations/new-editor#import-build>Connect to build server</a>" server
command in Metals to establish a connection with Bloop.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=custom-build-server>Custom build server<a href=#custom-build-server class=hash-link aria-label="Direct link to Custom build server" title="Direct link to Custom build server" translate=no>​</a></h2>
<p>Consult the
<a href=https://github.com/scalacenter/bsp/blob/master/docs/bsp.md target=_blank rel="noopener noreferrer" class="">BSP specification</a>
to learn about the protocol in detail.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=server-discovery>Server discovery<a href=#server-discovery class=hash-link aria-label="Direct link to Server discovery" title="Direct link to Server discovery" translate=no>​</a></h3>
<p>Metals automatically connects to a BSP server if the workspace root directory
contains a <code>.bsp/$name.json</code> file. For example, a build tool named "Bill" will
have a <code>.bsp/bill.json</code> file with the following information.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_e6Vv><span class=token-line style=color:#bfc7d5><span class="token plain">{</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  "name": "Bill",</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  "version": "1.0.0",</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  "bspVersion": "2.0.0",</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  "languages": ["scala"],</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">  "argv": ["bill", "bsp"]</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">}</span><br/></span></code></pre></div></div>
<p>When Metals detects a <code>.bsp/bill.json</code> file in the workspace:</p>
<ul>
<li class="">it starts a new process <code>bill bsp</code>, the command is derived from the <code>argv</code>
field in <code>bill.json</code>.</li>
<li class="">the working directory of the process is the workspace directory.</li>
<li class="">communication between Metals and the build server happens through standard
input/output.</li>
</ul>
<p>For a plug-and-play example of a build server, see <code>Bill.scala</code> in the Metals
repository. Bill is a basic build server that is used for testing and
demonstration purposes only.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=library-bindings>Library bindings<a href=#library-bindings class=hash-link aria-label="Direct link to Library bindings" title="Direct link to Library bindings" translate=no>​</a></h3>
<p>There are two available libraries to implement a BSP server:</p>
<ul>
<li class=""><code>ch.epfl.scala:bsp4j</code>: A Java library built with Java <code>CompletableFuture</code> for
async primitives and GSON for JSON serialization. This module is used by
Metals and the IntelliJ Scala plugin.</li>
<li class=""><code>ch.epfl.scala:bsp4s</code>: A Scala library built with Monix <code>Task</code>/<code>Observable</code>
for async primitives and Circe for JSON for serialization. This module is used
by the Bloop build server.</li>
</ul>
<p>Both libraries are compatible with each other. For example, it's OK to implement
a server with bsp4j and a client in bsp4s.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=manual-tests>Manual tests<a href=#manual-tests class=hash-link aria-label="Direct link to Manual tests" title="Direct link to Manual tests" translate=no>​</a></h3>
<p>You can manually test your build server integration by running Metals with your
editor of choice.</p>
<p>Create the following trace files to spy on incoming/outgoing JSON communication
between Metals and your build tool.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#bfc7d5;--prism-background-color:#292d3e><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#bfc7d5;background-color:#292d3e><code class=codeBlockLines_e6Vv><span class=token-line style=color:#bfc7d5><span class="token plain"># macOS</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">touch ~/Library/Caches/org.scalameta.metals/bsp.trace.json</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain"># Linux</span><br/></span><span class=token-line style=color:#bfc7d5><span class="token plain">touch ~/.cache/metals/bsp.trace.json</span><br/></span></code></pre></div></div>
<p>Metals must re-start to pick up the trace file.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=automated-tests>Automated tests<a href=#automated-tests class=hash-link aria-label="Direct link to Automated tests" title="Direct link to Automated tests" translate=no>​</a></h3>
<p>The Metals repository has infrastructure for running end-to-end integration
tests with build servers. To test your build server integration, you can to
clone the repository and write custom tests under
<code>tests/unit/src/test/scala/tests</code>.</p>
<p>If there is interest, we can publish a Metals <code>testkit</code> module to make it
possible to write tests outside the Metals repository.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=bsp-endpoints>BSP endpoints<a href=#bsp-endpoints class=hash-link aria-label="Direct link to BSP endpoints" title="Direct link to BSP endpoints" translate=no>​</a></h3>
<p>Metals requires the following BSP endpoints to be implemented by the build
server.</p>
<ul>
<li class=""><code>workspace/buildTargets</code>: to list all the build targets in the workspace.</li>
<li class=""><code>buildTarget/scalacOptions</code>: to know the classpath and compiler options used
to compile the project sources.</li>
<li class=""><code>buildTarget/sources</code>: to know what source files map to which build targets.</li>
<li class=""><code>buildTarget/dependencySources</code>: to support "Goto definition" for external
libraries.</li>
<li class=""><code>buildTarget/compile</code>: to trigger compilation in a build target.</li>
</ul>
<p>Additionally, Metals expects the server to send the following notifications:</p>
<ul>
<li class=""><code>buildTarget/publishDiagnostics</code>: To report compile errors and warnings in the
editor buffer.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href=https://github.com/scalameta/metals/edit/main/docs/integrations/new-build-tool.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/metals/docs/contributors/releasing><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Making a release</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/metals/docs/integrations/new-editor><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Integrating a new editor</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#enable-semanticdb class="table-of-contents__link toc-highlight">Enable SemanticDB</a><li><a href=#recommended-compiler-options class="table-of-contents__link toc-highlight">Recommended compiler options</a><li><a href=#bloop-build-server class="table-of-contents__link toc-highlight">Bloop build server</a><li><a href=#custom-build-server class="table-of-contents__link toc-highlight">Custom build server</a><ul><li><a href=#server-discovery class="table-of-contents__link toc-highlight">Server discovery</a><li><a href=#library-bindings class="table-of-contents__link toc-highlight">Library bindings</a><li><a href=#manual-tests class="table-of-contents__link toc-highlight">Manual tests</a><li><a href=#automated-tests class="table-of-contents__link toc-highlight">Automated tests</a><li><a href=#bsp-endpoints class="table-of-contents__link toc-highlight">BSP endpoints</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Overview</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/metals/docs/>Overview</a><li class=footer__item><a class=footer__link-item href=/metals/docs/build-tools/overview>Build Tools</a><li class=footer__item><a class=footer__link-item href=/metals/docs/contributors/project-goals>Project Goals</a><li class=footer__item><a class=footer__link-item href=/metals/docs/contributors/getting-started>Contributing</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Social</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/scalameta/metals target=_blank>
                      <img src="https://img.shields.io/github/stars/scalameta/metals.svg?color=%23087e8b&label=stars&logo=github&style=social"/>
                    </a><li class=footer__item><a href=https://discord.gg/RFpSVth target=_blank>
                      <img src="https://img.shields.io/discord/632642981228314653?logo=discord&style=social"/>
                    </a><li class=footer__item><a href=https://twitter.com/scalameta target=_blank>
                      <img src="https://img.shields.io/twitter/follow/scalameta.svg?logo=twitter&style=social"/>
                    </a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/metals/img/scalameta-logo.png class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/metals/img/scalameta-logo.png class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"/></div><div class=footer__copyright>Copyright © 2026 Metals</div></div></div></footer></div></body>